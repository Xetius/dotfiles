unbind C-b
set -g prefix C-Space
bind-key C-Space send-prefix

unbind r
bind r source-file ~/.config/tmux/tmux.conf

# Set split pane using - and |
bind = split-window -v -c "#{pane_current_path}"
bind _ split-window -h -c "#{pane_current_path}"
bind c new-window -c "#{pane_current_path}"

set-option -g mouse on

set -g base-index 1
set -g pane-base-index 1
set-window-option -g pane-base-index 1
set -g renumber-windows on

set -g history-limit 100000

set-window-option -g mode-keys vi

bind -T copy-mode-vi v send-keys -X begin-selection
bind -T copy-mode-vi C-v send-keys -X rectangle-toggle
bind -T copy-mode-vi y send-keys -X copy-selection-and-cancel

set-window-option -g status-position top
set -g status-justify absolute-centre

set -g status-position top
set -g status-interval 5
set -g status-right-length 100
set -g status-left-length 100

set -g popup-border-lines "rounded"

# Smart pane switching with awareness of Vim splits.
# See: https://github.com/christoomey/vim-tmux-navigator
vim_pattern='(\S+/)?g?\.?(view|l?n?vim?x?|fzf)(diff)?(-wrapped)?'
is_vim="ps -o state= -o comm= -t '#{pane_tty}'| grep -iqE '^[^TXZ ]+ +${vim_pattern}$'"

bind-key -n 'C-h' if-shell "$is_vim" 'send-keys C-h'  'select-pane -L'
bind-key -n 'C-j' if-shell "$is_vim" 'send-keys C-j'  'select-pane -D'
bind-key -n 'C-k' if-shell "$is_vim" 'send-keys C-k'  'select-pane -U'
bind-key -n 'C-l' if-shell "$is_vim" 'send-keys C-l'  'select-pane -R'

tmux_version='$(tmux -V | sed -En "s/^tmux ([0-9]+(.[0-9]+)?).*/\1/p")'
if-shell -b '[ "$(echo "$tmux_version < 3.0" | bc)" = 1 ]' \
    "bind-key -n 'C-\\' if-shell \"$is_vim\" 'send-keys C-\\'  'select-pane -l'"
if-shell -b '[ "$(echo "$tmux_version >= 3.0" | bc)" = 1 ]' \
    "bind-key -n 'C-\\' if-shell \"$is_vim\" 'send-keys C-\\\\'  'select-pane -l'"

bind-key -T copy-mode-vi 'C-h' select-pane -L
bind-key -T copy-mode-vi 'C-j' select-pane -D
bind-key -T copy-mode-vi 'C-k' select-pane -U
bind-key -T copy-mode-vi 'C-l' select-pane -R
bind-key -T copy-mode-vi 'C-\' select-pane -l

bind-key C-t display-popup -d "#{pane_current_path}" -w 90% -h 90% -E
bind-key C-g display-popup -d "#{pane_current_path}" -w 90% -h 90% -E "lazygit"
bind-key C-e display-popup -d "#{pane_current_path}" -w 90% -h 90% -E "yazi"
bind-key C-k display-popup -d "#{pane_current_path}" -w 90% -h 90% -E "k9s"

# Theme
# Gruvbox Dark colour scheme
col_bg="#282828"
col_bg0_h="#1d2021"
col_bg0="#282828"
col_bg1="#3c3836"
col_bg2="#504945"
col_bg3="#665c54"
col_bg4="#7c6f64"
col_gray0="#a89984"
col_gray1="#928374"
col_gray2="#928374"
col_bg0_s="#32302f"
col_fg="#ebdbb2"
col_fg4="#a89984"
col_fg3="#bdae93"
col_fg2="#d5c4a1"
col_fg1="#ebdbb2"
col_fg0="#fbf1c7"

col_red="#cc241d"
col_red2="#fb4934"
col_green="#98971a"
col_green2="#b8bb26"
col_yellow="#d79921"
col_yellow2="#fabd2f"
col_blue="#458588"
col_blue2="#83a598"
col_purple="#b16286"
col_purple2="#d3869b"
col_aqua="#689d6a"
col_aqua2="#8ec07c"
col_orange="#d65d0e"
col_orange2="#fe8019"

BG="#282828"
FG="#ebdbb2"
BUT="#3c3836"
BUT2="#665c54"

YELLOW="#d79921"
YELLOW2="#fabd2f"
RED="#fb4934"
GREEN="#b8bb26"
BLUE="#458588"

OPEN="#(printf '\uE0B6')"
CLOSE="#(printf '\uE0B4')"
SEPARATOR="#(printf '\uE0BA')"
CIRCLE="#(printf '\uf111')"

set -g status-style bg=${BG},fg=${FG}

set -g status-left "\
#[bg=default,fg=${BUT}]${OPEN}\
#[bg=${BUT},fg=${YELLOW}]#S\
#[bg=default,fg=${BUT}]${CLOSE}\
"

set -g status-right "\
#[bg=default,fg=${BUT}]${OPEN}\
#[bg=${BUT},fg=${YELLOW}]#h\
#[bg=default,fg=${BUT}]${CLOSE}"

set -g window-status-format "\
#[bg=default,fg=${BUT2}]${OPEN}\
#[bg=${BUT2},fg=${YELLOW}]#I \
#[bg=${BUT2},fg=${BUT}]${SEPARATOR}\
#[bg=${BUT},fg=${YELLOW}]#W\
#[bg=default,fg=${BUT}]${CLOSE}"

set -g window-status-current-format "#I${SEPARATOR}#W"
set -g window-status-current-format "\
#[bg=default,fg=${YELLOW2}]${OPEN}\
#[bg=${YELLOW2},fg=${BUT}]#I \
#[bg=${YELLOW2},fg=${YELLOW}]${SEPARATOR}\
#[bg=${YELLOW},fg=${BUT}]#W\
#[bg=default,fg=${YELLOW}]${CLOSE}"

# Tmux Plugin Manager
set -g @plugin "tmux-plugins/tpm"
set -g @plugin 'MunifTanjim/tmux-mode-indicator'
set -g @plugin 'christoomey/vim-tmux-navigator'
set -g @plugin 'omerxx/tmux-sessionx'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'

set -gF @mode_indicator_prefix_prompt "${CIRCLE}"
set -gF @mode_indicator_copy_prompt "${CIRCLE}"
set -gF @mode_indicator_sync_prompt "${CIRCLE}"
set -gF @mode_indicator_empty_prompt "${CIRCLE}"
set -gF @mode_indicator_prefix_mode_style "bg=default,fg=RED"
set -gF @mode_indicator_copy_mode_style "bg=default,fg=YELLOW"
set -gF @mode_indicator_sync_mode_style "bg=default,fg=BLUE"
set -gF @mode_indicator_empty_mode_style "bg=default,fg=GREEN"

set -ga status-left "#{tmux_mode_indicator}"

set -g @vim_navigator_mapping_left "C-Left C-h"  # use C-h and C-Left
set -g @vim_navigator_mapping_right "C-Right C-l"
set -g @vim_navigator_mapping_up "C-k"
set -g @vim_navigator_mapping_down "C-j"
set -g @vim_navigator_mapping_prev ""  # removes the C-\ binding

set -g @continuum-restore 'on'
set -g @continuum-boot-options 'ghostty,fullscreen'
set -g @resurrext-save 'S'
set -g @resurrext-restore 'E'

set -g @sessionx-bind 'C-o'
set -g @sessionx-prefix on
set -g @sessionx-fzf-builtin-tmux 'on'
set -g @sessionx-ls-command 'eza --tree --color=always --icons=always -a'
set -g @sessionx-zoxide-mode 'on'

set -g @continuum-restore 'on'

# Initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)
run "~/.config/tmux/plugins/tpm/tpm"
